<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Multi-Lot Parking Viewer</title>
  <script type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
  <script type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>
  <script type="module" src="https://unpkg.com/html5-qrcode"></script>
    <link rel="icon" type="image/png" href="favicon.png">
  <style>
    body { font-family: sans-serif; margin: 0; background: #f5f5f5; }
    .tabs { display: flex; justify-content: center; margin: 1em 0; }
    .tab-btn {
      padding: 0.5em 1em;
      margin: 0 0.25em;
      background: #ddd;
      border: none;
      cursor: pointer;
    }
    .tab-btn.active { background: #999; color: white; }
    #summary, #search-section { text-align: center; margin: 1em; }
    .lot-view {
      display: none;
      position: relative;
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
    }
    .lot-view.active { display: block; }
    .lot-view img {
      width: 100%;
      display: block;
    }
    .spot {
      position: absolute;
      width: 40px;
      height: 20px;
      background: rgba(0,128,0,0.6);
      color: white;
      text-align: center;
      line-height: 20px;
      font-size: 10px;
      border-radius: 4px;
      cursor: pointer;
    }
    .occupied { background: rgba(255,0,0,0.7); }
    #autocomplete-list {
      background: white;
      border: 1px solid #ccc;
      position: absolute;
      z-index: 10;
      width: 300px;
      margin: 0 auto;
      max-height: 150px;
      overflow-y: auto;
      left: 0;
      right: 0;
      margin-left: auto;
      margin-right: auto;
    }
    #autocomplete-list div { padding: 5px; cursor: pointer; }
    #autocomplete-list div:hover { background: #eee; }
    #scanner { width: 300px; margin: 10px auto; display: none; }
    table {
      margin: 2em auto;
      border-collapse: collapse;
      width: 90%;
    }
    th, td {
      padding: 8px;
      border: 1px solid #999;
      text-align: center;
    }
    th { background-color: #ccc; }
  </style>


</head>
<body>
  <div class="tabs">
    <button class="tab-btn active" data-lot="GG1">GG1 Lot</button>
    <button class="tab-btn" data-lot="GG2">GG2 Lot</button>
    <button class="tab-btn" data-lot="GN1">Gardena Lot</button>
  </div>

  <div id="summary">Occupied: 0 | Available: 0</div>



  <div id="GG1" class="lot-view active">
        <img src="GG1White.png" alt="GG1 Layout">
    
<div class="spot" id="GG1-R-01" style="top:437px; left:154px;">R-01</div>
<div class="spot" id="GG1-R-02" style="top:463px; left:154px;">R-02</div>
<div class="spot" id="GG1-R-03" style="top:488px; left:154px;">R-03</div>
<div class="spot" id="GG1-R-04" style="top:513px; left:154px;">R-04</div>
<div class="spot" id="GG1-R-05" style="top:539px; left:154px;">R-05</div>
<div class="spot" id="GG1-R-06" style="top:565px; left:154px;">R-06</div>


<!-- Column 1: GG1-S-01 to GG1-S-08 -->
<!-- Column 1 -->
<div class="spot" id="GG1-S-01" style="top: 325px; left: 309px;">S-01</div>
<div class="spot" id="GG1-S-02" style="top: 351px; left: 309px;">S-02</div>
<div class="spot" id="GG1-S-03" style="top: 375px; left: 309px;">S-03</div>
<div class="spot" id="GG1-S-04" style="top: 401px; left: 309px;">S-04</div>
<div class="spot" id="GG1-S-05" style="top: 427px; left: 309px;">S-05</div>
<div class="spot" id="GG1-S-06" style="top: 452px; left: 309px;">S-06</div>
<div class="spot" id="GG1-S-07" style="top: 478px; left: 309px;">S-07</div>
<div class="spot" id="GG1-S-08" style="top: 504px; left: 309px;">S-08</div>

<!-- Column 2 -->
<div class="spot" id="GG1-S-09" style="top: 325px; left: 385px;">S-09</div>
<div class="spot" id="GG1-S-10" style="top: 351px; left: 385px;">S-10</div>
<div class="spot" id="GG1-S-11" style="top: 377px; left: 385px;">S-11</div>
<div class="spot" id="GG1-S-12" style="top: 403px; left: 385px;">S-12</div>
<div class="spot" id="GG1-S-13" style="top: 429px; left: 385px;">S-13</div>
<div class="spot" id="GG1-S-14" style="top: 452px; left: 385px;">S-14</div>
<div class="spot" id="GG1-S-15" style="top: 478px; left: 385px;">S-15</div>
<div class="spot" id="GG1-S-16" style="top: 504px; left: 385px;">S-16</div>

<!-- Column 3 -->
<div class="spot" id="GG1-S-17" style="top: 325px; left: 461px;">S-17</div>
<div class="spot" id="GG1-S-18" style="top: 351px; left: 461px;">S-18</div>
<div class="spot" id="GG1-S-19" style="top: 375px; left: 461px;">S-19</div>
<div class="spot" id="GG1-S-20" style="top: 401px; left: 461px;">S-20</div>
<div class="spot" id="GG1-S-21" style="top: 427px; left: 461px;">S-21</div>
<div class="spot" id="GG1-S-22" style="top: 452px; left: 461px;">S-22</div>
<div class="spot" id="GG1-S-23" style="top: 478px; left: 461px;">S-23</div>
<div class="spot" id="GG1-S-24" style="top: 503px; left: 461px;">S-24</div>
<div class="spot" id="GG1-S-25" style="top: 529px; left: 461px;">S-25</div>
<div class="spot" id="GG1-S-26" style="top: 555px; left: 461px;">S-26</div>





<!-- Column 1: GG1-D-01 to GG1-D-11 -->
<div class="spot" id="GG1-D-01" style="top: 325px; left: 582px;">D-01</div>
<div class="spot" id="GG1-D-02" style="top: 351px; left: 582px;">D-02</div>
<div class="spot" id="GG1-D-03" style="top: 376px; left: 582px;">D-03</div>
<div class="spot" id="GG1-D-04" style="top: 402px; left: 582px;">D-04</div>
<div class="spot" id="GG1-D-05" style="top: 428px; left: 582px;">D-05</div>
<div class="spot" id="GG1-D-06" style="top: 455px; left: 582px;">D-06</div>
<div class="spot" id="GG1-D-07" style="top: 478.5px; left: 582px;">D-07</div>
<div class="spot" id="GG1-D-08" style="top: 503px; left: 582px;">D-08</div>
<div class="spot" id="GG1-D-09" style="top: 529px; left: 582px;">D-09</div>
<div class="spot" id="GG1-D-10" style="top: 555px; left: 582px;">D-10</div>
<div class="spot" id="GG1-D-11" style="top: 581px; left: 582px;">D-11</div>

<!-- Column 2: GG1-D-12 to GG1-D-22 -->
<div class="spot" id="GG1-D-12" style="top: 325px; left: 661px;">D-12</div>
<div class="spot" id="GG1-D-13" style="top: 351px; left: 661px;">D-13</div>
<div class="spot" id="GG1-D-14" style="top: 376px; left: 661px;">D-14</div>
<div class="spot" id="GG1-D-15" style="top: 402px; left: 661px;">D-15</div>
<div class="spot" id="GG1-D-16" style="top: 428px; left: 661px;">D-16</div>
<div class="spot" id="GG1-D-17" style="top: 455px; left: 661px;">D-17</div>
<div class="spot" id="GG1-D-18" style="top: 478.5px; left: 661px;">D-18</div>
<div class="spot" id="GG1-D-19" style="top: 503px; left: 661px;">D-19</div>
<div class="spot" id="GG1-D-20" style="top: 529px; left: 661px;">D-20</div>
<div class="spot" id="GG1-D-21" style="top: 555px; left: 661px;">D-21</div>
<div class="spot" id="GG1-D-22" style="top: 581px; left: 661px;">D-22</div>


<div class="spot" id="GG1-V-01" style="top: 522px; left: 775px; transform: rotate(270deg);">V-01</div>
<div class="spot" id="GG1-V-02" style="top: 436px; left: 775px; transform: rotate(270deg);">V-02</div>


<div class="spot" id="GG1-V-03" style="top: 376px; left: 831px;">V-03</div>
<div class="spot" id="GG1-V-04" style="top: 402px; left: 831px;">V-04</div>
<div class="spot" id="GG1-V-05" style="top: 428px; left: 831px;">V-05</div>
<div class="spot" id="GG1-V-06" style="top: 454px; left: 831px;">V-06</div>
<div class="spot" id="GG1-V-07" style="top: 479px; left: 831px;">V-07</div>
<div class="spot" id="GG1-V-08" style="top: 504px; left: 831px;">V-08</div>
<div class="spot" id="GG1-V-09" style="top: 529px; left: 831px;">V-09</div>
<div class="spot" id="GG1-V-10" style="top: 555px; left: 831px;">V-10</div>

<div class="spot" id="GG1-V-11" style="top: 412.5px; left: 973px;">V-11</div>
<div class="spot" id="GG1-V-12" style="top: 438.5px; left: 973px;">V-12</div>
<div class="spot" id="GG1-V-13" style="top: 463.5px; left: 973px;">V-13</div>

<div class="spot" id="GG1-V-14" style="top: 525px; left: 934px; transform: rotate(270deg);">V-14</div>
<div class="spot" id="GG1-V-15" style="top: 525px; left: 960px; transform: rotate(270deg);">V-15</div>
<div class="spot" id="GG1-V-16" style="top: 525px; left: 985px; transform: rotate(270deg);">V-16</div>
<div class="spot" id="GG1-V-17" style="top: 525px; left: 1010px; transform: rotate(270deg);">V-17</div>

  </div>

    <div id="GG2" class="lot-view">
    <img src="GGG.png" alt="GG2 Layout">
<!-- Left column -->



<div class="spot" id="GG2-B-06" style="top: 363px; left: 437.5px; transform: rotate(270deg);">B-06</div>
<div class="spot" id="GG2-B-05" style="top: 443px; left: 437.5px; transform: rotate(270deg);">B-05</div>
<div class="spot" id="GG2-B-04" style="top: 513px; left: 437.5px; transform: rotate(270deg);">B-04</div>


<div class="spot" id="GG2-B-03" style="top: 363px; left: 413.5px; transform: rotate(270deg);">B-03</div>
<div class="spot" id="GG2-B-02" style="top: 443px; left: 413.5px; transform: rotate(270deg);">B-02</div>
<div class="spot" id="GG2-B-01" style="top: 513px; left: 413.5px; transform: rotate(270deg);">B-01</div>

<!-- Column 3 -->
<div class="spot" id="GG2-B-09" style="top: 363px; left: 461.5px; transform: rotate(270deg);">B-09</div>
<div class="spot" id="GG2-B-08" style="top: 443px; left: 461.5px; transform: rotate(270deg);">B-08</div>
<div class="spot" id="GG2-B-07" style="top: 513px; left: 461.5px; transform: rotate(270deg);">B-07</div>

<!-- Column 4 -->
<div class="spot" id="GG2-B-12" style="top: 363px; left: 485.5px; transform: rotate(270deg);">B-12</div>
<div class="spot" id="GG2-B-11" style="top: 443px; left: 485.5px; transform: rotate(270deg);">B-11</div>
<div class="spot" id="GG2-B-10" style="top: 513px; left: 485.5px; transform: rotate(270deg);">B-10</div>

<!-- Column 5 -->
<div class="spot" id="GG2-B-15" style="top: 363px; left: 509.5px; transform: rotate(270deg);">B-15</div>
<div class="spot" id="GG2-B-14" style="top: 443px; left: 509.5px; transform: rotate(270deg);">B-14</div>
<div class="spot" id="GG2-B-13" style="top: 513px; left: 509.5px; transform: rotate(270deg);">B-13</div>

<!-- Column 6 -->
<div class="spot" id="GG2-B-17" style="top: 363px; left: 533.5px; transform: rotate(270deg);">B-17</div>
<div class="spot" id="GG2-B-16" style="top: 443px; left: 533.5px; transform: rotate(270deg);">B-16</div>



<div class="spot" id="GG2-C-01" style="top: 448px; left: 564px; transform: rotate(270deg);">C-01</div>
<div class="spot" id="GG2-C-02" style="top: 376px; left: 564px; transform: rotate(270deg);">C-02</div>
<div class="spot" id="GG2-C-03" style="top: 448px; left: 587px; transform: rotate(270deg);">C-03</div>
<div class="spot" id="GG2-C-04" style="top: 376px; left: 587px; transform: rotate(270deg);">C-04</div>
<div class="spot" id="GG2-C-05" style="top: 448px; left: 609px; transform: rotate(270deg);">C-05</div>
<div class="spot" id="GG2-C-06" style="top: 376px; left: 609px; transform: rotate(270deg);">C-06</div>
<div class="spot" id="GG2-C-07" style="top: 504px; left: 595.5px;;">C-07</div>
<div class="spot" id="GG2-C-08" style="top: 352px; left: 653px;">C-08</div>
<div class="spot" id="GG2-C-09" style="top: 377px; left: 653px;">C-09</div>
<div class="spot" id="GG2-C-10" style="top: 402px; left: 653px;">C-10</div>
<div class="spot" id="GG2-C-11" style="top: 427px; left: 653px;">C-11</div>
<div class="spot" id="GG2-C-12" style="top: 452px; left: 653px;">C-12</div>
<div class="spot" id="GG2-C-13" style="top: 477px; left: 653px;">C-13</div>
<div class="spot" id="GG2-C-14" style="top: 426px; left: 692px; transform: rotate(270deg);">C-14</div>
<div class="spot" id="GG2-C-15" style="top: 384px; left: 692px; transform: rotate(270deg);">C-15</div>
<div class="spot" id="GG2-C-16" style="top: 353px; left: 733px;">C-16</div>
<div class="spot" id="GG2-C-17" style="top: 378px; left: 733px;">C-17</div>
<div class="spot" id="GG2-C-18" style="top: 403px; left: 733px;">C-18</div>
<div class="spot" id="GG2-C-19" style="top: 428px; left: 733px;">C-19</div>
<div class="spot" id="GG2-C-20" style="top: 453px; left: 733px;">C-20</div>
<div class="spot" id="GG2-C-21" style="top: 478px; left: 733px;">C-21</div>









<div class="spot" id="GG2-D-01" style="top: 608px; left: 472px;">D-01</div>
<div class="spot" id="GG2-D-02" style="top: 608px; left: 514px;">D-02</div>
<div class="spot" id="GG2-D-03" style="top: 568px; left: 614px; transform: rotate(270deg);">D-03</div>
<div class="spot" id="GG2-D-04" style="top: 568px; left: 639px; transform: rotate(270deg);">D-04</div>
<div class="spot" id="GG2-D-05" style="top: 568px; left: 702px; transform: rotate(270deg);">D-05</div>
<div class="spot" id="GG2-D-06" style="top: 568px; left: 723px; transform: rotate(270deg);">D-06</div>
<div class="spot" id="GG2-D-07" style="top: 514px; left: 813px; transform: rotate(270deg);">D-07</div>
<div class="spot" id="GG2-D-08" style="top: 514px; left: 835px; transform: rotate(270deg);">D-08</div>
<div class="spot" id="GG2-D-09" style="top: 587px; left: 813px; transform: rotate(270deg);">D-09</div>
<div class="spot" id="GG2-D-10" style="top: 587px; left: 835px; transform: rotate(270deg);">D-10</div>

<div class="spot" id="GG2-E-01" style="top: 397px; left: 808px; transform: rotate(270deg);">E-01</div>
<div class="spot" id="GG2-E-02" style="top: 397px; left: 834px; transform: rotate(270deg);">E-02</div>
<div class="spot" id="GG2-E-03" style="top: 332px; left: 808px; transform: rotate(270deg);">E-03</div>
<div class="spot" id="GG2-E-04" style="top: 332px; left: 834px; transform: rotate(270deg);">E-04</div>

<div class="spot" id="GG2-E-05" style="top: 264px; left: 808px; transform: rotate(270deg);">E-05</div>
<div class="spot" id="GG2-E-06" style="top: 264px; left: 834px; transform: rotate(270deg);">E-06</div>
<div class="spot" id="GG2-E-07" style="top: 195px; left: 808px; transform: rotate(270deg);">E-07</div>
<div class="spot" id="GG2-E-08" style="top: 195px; left: 834px; transform: rotate(270deg);">E-08</div>
<div class="spot" id="GG2-E-09" style="top: 127px; left: 808px; transform: rotate(270deg);">E-09</div>
<div class="spot" id="GG2-E-10" style="top: 127px; left: 834px; transform: rotate(270deg);">E-10</div>
<div class="spot" id="GG2-E-11" style="top: 58px; left: 823px;">E-11</div>
  </div>
  
<div id="GN1" class="lot-view">
  <img src="GardenaLotWhite.png" alt="Gardena Layout">

<!-- Column A  -->
<div class="spot" id="GN1-A-01" style="top:71px; left:450px;">A-01</div>
<div class="spot" id="GN1-A-02" style="top:100px; left:450px;">A-02</div>
<div class="spot" id="GN1-A-03" style="top:128px; left:450px;">A-03</div>
<div class="spot" id="GN1-A-04" style="top:157px; left:450px;">A-04</div>
<div class="spot" id="GN1-A-05" style="top:184px; left:450px;">A-05</div>
<div class="spot" id="GN1-A-06" style="top:212px; left:450px;">A-06</div>
<div class="spot" id="GN1-A-07" style="top:240px; left:450px;">A-07</div>
<div class="spot" id="GN1-A-08" style="top:268px; left:450px;">A-08</div>
<div class="spot" id="GN1-A-09" style="top:332px; left:486px; transform: rotate(90deg);">A-09</div>
<div class="spot" id="GN1-A-10" style="top:332px; left:459px; transform: rotate(90deg);">A-10</div>
<div class="spot" id="GN1-A-11" style="top:332px; left:431px; transform: rotate(90deg);">A-11</div>
<!-- Column starting from A-12 -->
<div class="spot" id="GN1-A-12" style="top:420px; left:486px; transform: rotate(90deg);">A-12</div>
<div class="spot" id="GN1-A-13" style="top:420px; left:460px; transform: rotate(90deg);">A-13</div>
<div class="spot" id="GN1-A-14" style="top:420px; left:433px; transform: rotate(90deg);">A-14</div>
<div class="spot" id="GN1-A-15" style="top:420px; left:405px; transform: rotate(90deg);">A-15</div>

<!-- Column starting from A-16 -->
<div class="spot" id="GN1-A-16" style="top:491px; left:486px; transform: rotate(90deg);">A-16</div>
<div class="spot" id="GN1-A-17" style="top:491px; left:460px; transform: rotate(90deg);">A-17</div>
<div class="spot" id="GN1-A-18" style="top:491px; left:433px; transform: rotate(90deg);">A-18</div>
<div class="spot" id="GN1-A-19" style="top:491px; left:405px; transform: rotate(90deg);">A-19</div>

<!-- Column starting from A-20 -->
<div class="spot" id="GN1-A-20" style="top:567px; left:486px; transform: rotate(90deg);">A-20</div>
<div class="spot" id="GN1-A-21" style="top:567px; left:460px; transform: rotate(90deg);">A-21</div>
<div class="spot" id="GN1-A-22" style="top:567px; left:433px; transform: rotate(90deg);">A-22</div>
<div class="spot" id="GN1-A-23" style="top:567px; left:405px; transform: rotate(90deg);">A-23</div>



<!-- Column B  -->
<div class="spot" id="GN1-B-01" style="top:75px; left:548px;">B-01</div>
<div class="spot" id="GN1-B-02" style="top:102.5px; left:548px;">B-02</div>
<div class="spot" id="GN1-B-03" style="top:131px; left:548px;">B-03</div>
<div class="spot" id="GN1-B-04" style="top:159.5px; left:548px;">B-04</div>
<div class="spot" id="GN1-B-05" style="top:187px; left:548px;">B-05</div>
<div class="spot" id="GN1-B-06" style="top:215.5px; left:548px;">B-06</div>
<div class="spot" id="GN1-B-07" style="top:244px; left:548px;">B-07</div>
<div class="spot" id="GN1-B-08" style="top:271px; left:548px;">B-08</div>
<div class="spot" id="GN1-B-09" style="top:299px; left:548px;">B-09</div>
<div class="spot" id="GN1-B-10" style="top:329.5px; left:548px;">B-10</div>
<div class="spot" id="GN1-B-11" style="top:357px; left:548px;">B-11</div>
<div class="spot" id="GN1-B-12" style="top:384.5px; left:548px;">B-12</div>
<div class="spot" id="GN1-B-13" style="top:412px; left:548px;">B-13</div>
<div class="spot" id="GN1-B-14" style="top:439.5px; left:548px;">B-14</div>
<div class="spot" id="GN1-B-15" style="top:467px; left:548px;">B-15</div>
<div class="spot" id="GN1-B-16" style="top:496.5px; left:548px;">B-16</div>
<div class="spot" id="GN1-B-17" style="top:524px; left:548px;">B-17</div>
<div class="spot" id="GN1-B-18" style="top:551px; left:548px;">B-18</div>
<div class="spot" id="GN1-B-19" style="top:580px; left:548px;">B-19</div>


<!-- Column C  -->
<div class="spot" id="GN1-C-01" style="top:75px; left:638px;">C-01</div>
<div class="spot" id="GN1-C-02" style="top:102.5px; left:638px;">C-02</div>
<div class="spot" id="GN1-C-03" style="top:131px; left:638px;">C-03</div>
<div class="spot" id="GN1-C-04" style="top:159.5px; left:638px;">C-04</div>
<div class="spot" id="GN1-C-05" style="top:187px; left:638px;">C-05</div>
<div class="spot" id="GN1-C-06" style="top:215.5px; left:638px;">C-06</div>
<div class="spot" id="GN1-C-07" style="top:244px; left:638px;">C-07</div>
<div class="spot" id="GN1-C-08" style="top:271px; left:638px;">C-08</div>
<div class="spot" id="GN1-C-09" style="top:299px; left:638px;">C-09</div>
<div class="spot" id="GN1-C-10" style="top:329.5px; left:638px;">C-10</div>
<div class="spot" id="GN1-C-11" style="top:357px; left:638px;">C-11</div>
<div class="spot" id="GN1-C-12" style="top:384.5px; left:638px;">C-12</div>
<div class="spot" id="GN1-C-13" style="top:412px; left:638px;">C-13</div>
<div class="spot" id="GN1-C-14" style="top:439.5px; left:638px;">C-14</div>
<div class="spot" id="GN1-C-15" style="top:467px; left:638px;">C-15</div>
<div class="spot" id="GN1-C-16" style="top:496.5px; left:638px;">C-16</div>
<div class="spot" id="GN1-C-17" style="top:524px; left:638px;">C-17</div>
<div class="spot" id="GN1-C-18" style="top:551px; left:638px;">C-18</div>
<div class="spot" id="GN1-C-19" style="top:580px; left:638px;">C-19</div>


<!-- Column D  -->
<div class="spot" id="GN1-D-01" style="top:75px; left:738px;">D-01</div>
<div class="spot" id="GN1-D-02" style="top:105px; left:738px;">D-02</div>
<div class="spot" id="GN1-D-03" style="top:134px; left:738px;">D-03</div>
<div class="spot" id="GN1-D-04" style="top:163px; left:738px;">D-04</div>
<div class="spot" id="GN1-D-05" style="top:192px; left:738px;">D-05</div>
<div class="spot" id="GN1-D-06" style="top:222px; left:738px;">D-06</div>
<div class="spot" id="GN1-D-07" style="top:251px; left:738px;">D-07</div>




</div>
  


    <div id="search-section">
    <input type="text" id="search-vin" placeholder="Search VIN" style="width: 300px;">
    <button id="scan-vin-btn">ðŸ“· Scan VIN</button>
    <div id="autocomplete-list"></div>
    <div id="scanner"></div>
  </div>
<br>
 <hr />

<br>

  <h2 style="text-align:center;">Current VIN Assignments</h2>
  <table id="vin-table">
    <thead>
      <tr>
        <th>Lot</th>
        <th>Spot ID</th>
        <th>VIN</th>
        <th>Last Updated</th>
      </tr>
    </thead>
    <tbody id="vin-table-body"></tbody>
  </table>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getFirestore, collection, getDocs, getDoc, setDoc, deleteDoc, doc, onSnapshot
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAkm-POkijRQ1uelpSTK7LTPa0U251CAJ4",
  authDomain: "two-tab-lot.firebaseapp.com",
  projectId: "two-tab-lot",
  storageBucket: "two-tab-lot.firebasestorage.app",
  messagingSenderId: "244126304424",
  appId: "1:244126304424:web:b85a90b31afa0f72931a9d"
};

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let currentLotId = 'GG1';
    const summaryEl = document.getElementById('summary');
    const searchInput = document.getElementById('search-vin');
    const autocompleteList = document.getElementById('autocomplete-list');
    const scannerEl = document.getElementById('scanner');
    const vinTableBody = document.getElementById('vin-table-body');

    const tabButtons = document.querySelectorAll('.tab-btn');
    tabButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelector('.tab-btn.active').classList.remove('active');
        btn.classList.add('active');
        currentLotId = btn.dataset.lot;

        document.querySelectorAll('.lot-view').forEach(view => view.classList.remove('active'));
        document.getElementById(currentLotId).classList.add('active');

        loadSpots(currentLotId);
      });
    });

    function updateSummary(occupiedCount, total) {
      summaryEl.textContent = `Occupied: ${occupiedCount} | Available: ${total - occupiedCount}`;
    }

    function updateTable(lotId, snapshot) {
      vinTableBody.innerHTML = '';
      snapshot.forEach(doc => {
        const data = doc.data();
        if (!data.vin) return;
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${lotId}</td>
          <td>${doc.id}</td>
          <td>${data.vin}</td>
          <td>${data.updatedAt || ''}</td>
        `;
        vinTableBody.appendChild(row);
      });
    }

    function attachClickListenersOnce() {
  const spots = document.querySelectorAll('.spot');

  spots.forEach(spot => {
    // Remove any existing click handlers to prevent duplicates
    spot.replaceWith(spot.cloneNode(true));
  });

  const freshSpots = document.querySelectorAll('.spot');

  freshSpots.forEach(spot => {
    const spotId = spot.id;
    const label = spot.dataset.label || spot.innerText;
    spot.dataset.label = label;

spot.addEventListener('click', async () => {
  try {
    const lotId = spotId.split('-')[0];
    const docRef = doc(db, "parkingLots", lotId, "parkingSpots", spotId);
    
    console.log("Fetching VIN from:", `parkingLots/${lotId}/parkingSpots/${spotId}`);

    const docSnap = await getDoc(docRef);
    const currentVIN = docSnap.exists() ? docSnap.data().vin || '' : '';

    const newVIN = prompt(`Enter VIN for spot ${label} (Current: ${currentVIN || 'None'})`, currentVIN);

    if (newVIN && newVIN.trim() !== '') {
      await setDoc(docRef, {
        vin: newVIN.trim(),
        updatedAt: new Date().toISOString()
      });
      console.log("âœ… VIN saved:", newVIN.trim());
    } else if (currentVIN) {
      const confirmDelete = confirm("Clear this VIN from the spot?");
      if (confirmDelete) {
        await deleteDoc(docRef);
        console.log("ðŸ—‘ï¸ VIN deleted from:", `parkingLots/${lotId}/parkingSpots/${spotId}`);
      }
    } else {
      console.log("â„¹ï¸ No VIN entered or deleted.");
    }
  } catch (error) {
    console.error("ðŸ”¥ Error saving or deleting VIN:", error);
  }
});

  });
}



function loadSpots(lotId) {
  const spotsRef = collection(db, 'parkingLots', lotId, 'parkingSpots');
  onSnapshot(spotsRef, snapshot => {
    let occupied = 0;
    updateTable(lotId, snapshot);

    snapshot.forEach(docSnap => {
      const spotId = docSnap.id;
      const data = docSnap.data();
      const vin = data.vin?.trim();
      const el = document.getElementById(spotId);
      if (!el) return;

      // Store the original label if not already stored
      const label = el.dataset.label || el.innerText;
      el.dataset.label = label;

      // Default: reset label and remove "occupied"
      el.innerText = label;
      el.classList.remove('occupied');

      if (vin) {
        // Mark as occupied
        el.classList.add('occupied');
        occupied++;

        // Get last 4 characters of VIN, padded with 0s
        let last4 = vin.slice(-4);
        if (last4.length < 4) {
          last4 = last4.padStart(4, '0');
        }

        // Replace label with VIN ending
        el.innerText = last4;
      }
    });

    const total = document.querySelectorAll(`#${lotId} .spot`).length;
    updateSummary(occupied, total);

    attachClickListenersOnce(); // Rebind after updates
  });
}




    loadSpots(currentLotId);


const searchResult = document.createElement('div');
searchResult.id = 'search-result';
searchResult.style.marginTop = '10px';
searchResult.style.fontWeight = 'bold';
document.getElementById('search-section').appendChild(searchResult);

let vinMap = {}; // VIN -> { spotId, lotId }

async function fetchVINs() {
  vinMap = {};
  const lots = ['GG1', 'GG2', 'GN1'];
  for (const lotId of lots) {
    const snapshot = await getDocs(collection(db, "parkingLots", lotId, "parkingSpots"));
    snapshot.forEach(doc => {
      const data = doc.data();
      if (data.vin) {
        vinMap[data.vin.toUpperCase()] = { spotId: doc.id, lotId };
      }
    });
  }
}

searchInput.addEventListener("input", () => {
  const val = searchInput.value.trim().toUpperCase();
  autocompleteList.innerHTML = '';
  if (!val || val.length < 2) return;

  Object.keys(vinMap)
    .filter(vin => vin.includes(val))
    .slice(0, 10)
    .forEach(match => {
      const option = document.createElement("div");
      option.textContent = match;
      option.style.padding = "6px";
      option.style.cursor = "pointer";
      option.addEventListener("click", () => {
        searchInput.value = match;
        autocompleteList.innerHTML = '';
        handleVINSelect(match);
        attachClickListenersOnce();

      });
      autocompleteList.appendChild(option);
    });
});

document.addEventListener("click", (e) => {
  if (!autocompleteList.contains(e.target) && e.target !== searchInput) {
    autocompleteList.innerHTML = '';
  }
});

function handleVINSelect(vin) {
  const match = vinMap[vin.toUpperCase()];
  if (!match) {
    searchResult.textContent = "âŒ VIN not found in any spot.";
    return;
  }

  const { spotId, lotId } = match;
  searchResult.textContent = `âœ… VIN found in lot ${lotId}, spot: ${spotId}`;

  // Switch tab if necessary
  if (lotId !== currentLotId) {
    document.querySelector('.tab-btn.active').classList.remove('active');
    document.querySelector(`.tab-btn[data-lot="${lotId}"]`).classList.add('active');
    document.querySelectorAll('.lot-view').forEach(view => view.classList.remove('active'));
    document.getElementById(lotId).classList.add('active');
    currentLotId = lotId;
  }

  const spotEl = document.getElementById(spotId);
  if (spotEl) {
    spotEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
    spotEl.style.outline = "3px solid gold";
    setTimeout(() => spotEl.style.outline = "", 2000);
  }
}

fetchVINs();


  </script>
</body>
</html>
